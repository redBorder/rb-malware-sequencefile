package net.redborder.malware.sequencefile.leader;

import net.redborder.malware.sequencefile.peons.SequenceManager;
import net.redborder.malware.sequencefile.util.ConfigFile;
import net.redborder.taskassigner.ZkTasksHandler;

public class SequenceLeader extends Thread{
    private static final long ONE_MINUTE = 60000;
    private ZkTasksHandler tasksHandler;
    private SequenceManager sequenceManager;
    private Boolean running = false;

    public SequenceLeader(){
        tasksHandler = new ZkTasksHandler(ConfigFile.getInstance().getZkConnect(), "/rb-malware/sequence-file");
        sequenceManager = new SequenceManager();
        tasksHandler.addListener(sequenceManager);
        running = true;
    }

    @Override
    public synchronized void start() {
        super.start();
        sequenceManager.start();
    }

    @Override
    public void run() {
        while(running) {
            if (tasksHandler.isLeader()) {

                //TODO: Preparar los ficheros s3.

                //tasksHandler.setTasks();
                //tasksHandler.wakeup();
            } else {
                try {
                    Thread.sleep(ONE_MINUTE);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }
    }

    public void close(){
        running=false;
        sequenceManager.close();
    }
}
