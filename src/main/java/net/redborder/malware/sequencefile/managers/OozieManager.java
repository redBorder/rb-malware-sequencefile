package net.redborder.malware.sequencefile.managers;

import net.redborder.clusterizer.Task;
import net.redborder.clusterizer.TasksChangedListener;

import java.io.FileNotFoundException;
import java.util.ArrayList;
import java.util.List;

/**
 * Created by Lito on 11/2/15.
 */
public class OozieManager extends Thread {

    private static OozieManager theInstance = null;
    private static final Object initMonitor = new Object();
    List<String> seqFiles;

    public OozieManager() {
        seqFiles = new ArrayList<>();
    }

    public static OozieManager getInstance() {
        if (theInstance == null) {
            synchronized (initMonitor) {
                try {
                    while (theInstance == null) {
                        initMonitor.wait();
                    }
                } catch (InterruptedException e) {
                    // ignore
                }
            }
        }
        return theInstance;
    }

    public static void init() {
        synchronized (initMonitor) {
            if (theInstance == null) {
                theInstance = new OozieManager();
                theInstance.start();
                initMonitor.notifyAll();
            }
        }
    }

    public static void updateSeqFiles(List<String> seqFiles) {
        if (theInstance != null) {
            theInstance.update(seqFiles);
        }
    }

    public void update(List<String> seqFiles) {
        this.seqFiles.addAll(seqFiles);
    }

    @Override
    public void run() {
        while (true) {
            if (seqFiles.size() > 0) {

                System.out.println("LISTA: " + seqFiles);
                seqFiles.clear();
            } else
                try {
                    Thread.sleep(2000);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
        }
    }
}
